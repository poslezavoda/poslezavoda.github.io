<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>üíß –í–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏</h1>
            <button id="closeApp" class="btn-close">‚úï</button>
        </header>

        <div id="appContent">
            <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
            <div id="mainMenu" class="section active">
                <div class="button-grid">
                    <button class="btn-large" onclick="showSection('createWatermark')">
                        üÜï –°–æ–∑–¥–∞—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫
                    </button>
                    <button class="btn-large" onclick="loadWatermarks()">
                        üìÅ –ú–æ–∏ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏
                    </button>
                    <button class="btn-large" onclick="showSection('applyWatermark')">
                        üì§ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –º–µ–¥–∏–∞
                    </button>
                </div>
            </div>

            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
            <div id="createWatermark" class="section">
                <h2>–°–æ–∑–¥–∞—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</h2>
                
                <div class="form-group">
                    <label>–¢–∏–ø –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞:</label>
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-type="text">‚úèÔ∏è –¢–µ–∫—Å—Ç</button>
                        <button class="toggle-btn" data-type="image">üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                    </div>
                </div>

                <div id="textSection" class="form-group">
                    <label>–¢–µ–∫—Å—Ç:</label>
                    <input type="text" id="watermarkText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..." maxlength="50">
                </div>

                <div id="imageSection" class="form-group" style="display: none;">
                    <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
                    <input type="file" id="watermarkImage" accept="image/*" style="display: none;">
                    <button class="btn-secondary" onclick="document.getElementById('watermarkImage').click()">
                        üìÅ –í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    </button>
                    <div id="imagePreview"></div>
                </div>

                <div class="form-group">
                    <label>–†–∞–∑–º–µ—Ä:</label>
                    <select id="watermarkSize">
                        <option value="small">üîò –ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                        <option value="medium" selected>üîò –°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="large">üîò –ë–æ–ª—å—à–æ–π</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ü–æ–∑–∏—Ü–∏—è:</label>
                    <div class="position-grid">
                        <button class="position-btn" data-position="top-left">‚ÜñÔ∏è</button>
                        <button class="position-btn" data-position="top-right">‚ÜóÔ∏è</button>
                        <button class="position-btn" data-position="center">‚è∫Ô∏è</button>
                        <button class="position-btn active" data-position="bottom-left">‚ÜôÔ∏è</button>
                        <button class="position-btn" data-position="bottom-right">‚ÜòÔ∏è</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>–ù–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</label>
                    <input type="range" id="opacity" min="0" max="100" value="50">
                    <span id="opacityValue">50%</span>
                </div>

                <div class="button-row">
                    <button class="btn-secondary" onclick="showSection('mainMenu')">–ù–∞–∑–∞–¥</button>
                    <button class="btn-primary" onclick="saveWatermark()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>

            <!-- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
            <div id="applyWatermark" class="section">
                <h2>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</h2>
                
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫:</label>
                    <select id="selectWatermark" onchange="previewWatermark()">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –º–µ–¥–∏–∞:</label>
                    <input type="file" id="mediaInput" multiple accept="image/*,video/*" style="display: none;">
                    <button class="btn-secondary" onclick="document.getElementById('mediaInput').click()">
                        üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã
                    </button>
                    <div id="mediaPreview"></div>
                </div>

                <div class="preview-container">
                    <canvas id="previewCanvas"></canvas>
                </div>

                <div class="form-group">
                    <label>–ö–∞—á–µ—Å—Ç–≤–æ:</label>
                    <select id="quality">
                        <option value="0.7">–°—Ä–µ–¥–Ω–µ–µ</option>
                        <option value="0.9" selected>–í—ã—Å–æ–∫–æ–µ</option>
                        <option value="1">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ</option>
                    </select>
                </div>

                <div class="progress-container" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-text">–û–±—Ä–∞–±–æ—Ç–∫–∞: <span class="progress-percent">0%</span></div>
                </div>

                <div class="button-row">
                    <button class="btn-secondary" onclick="showSection('mainMenu')">–ù–∞–∑–∞–¥</button>
                    <button class="btn-primary" onclick="processMedia()" id="processBtn">
                        üöÄ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å
                    </button>
                </div>
            </div>

            <!-- –ú–æ–∏ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏ -->
            <div id="myWatermarks" class="section">
                <h2>–ú–æ–∏ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏</h2>
                <div id="watermarksList"></div>
                <button class="btn-secondary" onclick="showSection('mainMenu')">–ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="watermark-processor.js"></script>
</body>
</html>